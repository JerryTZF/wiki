---
sidebar: [
{text: 'ğŸ³ Docker', collapsible: true, children:[
{text: 'Basic', link: '/zh/knowledge/docker/docker'},
{text: 'CI/CD', link: '/zh/knowledge/docker/cicd'},
{text: 'Volume', link: '/zh/knowledge/docker/volume'},
{text: 'Network', link: '/zh/knowledge/docker/network'},
{text: 'å¸¸ç”¨å‘½ä»¤', link: '/zh/knowledge/docker/command'},
]},
{text: 'ğŸ› Docker compose', link: '/zh/knowledge/docker/docker-compose'},
{text: 'ğŸ•¸ Docker swarm', link: '/zh/knowledge/docker/docker-swarm'},
{text: 'ğŸ™ K8s', link: '/zh/knowledge/docker/k8s'},
]

prev: /zh/knowledge/container
next: /zh/knowledge/docker/cicd

---

# Docker

ç›®å½•
[[toc]]


::: warning æˆ‘æœ€å¼€å§‹ä½¿ç”¨ Docker çš„åŸå› 
åœ¨ä½¿ç”¨ `Docker` å‰ï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“æˆ‘ä»¬çš„è¯‰æ±‚å’Œç—›ç‚¹æ˜¯ä»€ä¹ˆï¼Œç„¶åå»äº†è§£ `Docker` æ˜¯å¦å¯ä»¥è§£å†³æˆ‘ä»¬çš„ç—›ç‚¹ï¼›

---

ä»¥æˆ‘ä¸ºä¾‹ï¼š

- `Swoole` æ— æ³•è·‘åœ¨ `Windows` ä¸Š( ç°åœ¨å¯ä»¥äº†:smile: )ï¼Œä½†æ˜¯Dockerè™šæ‹ŸåŒ–å‡ºå¯¹åº”çš„ç¯å¢ƒå¯ä»¥è§£å†³ã€‚
- å¤šä¸ªé¡¹ç›®ä¾èµ–çš„ `PHP` ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå¹¶ä¸”éœ€è¦åœ¨ `Nginx` ä¸Šé…ç½®å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚
- ä»£ç ç»´æŠ¤èµ·æ¥éå¸¸éº»çƒ¦ï¼Œå¤šä¸ªç¯å¢ƒï¼Œå¤šä¸ªç‰ˆæœ¬ï¼Œæœ‰æ—¶è¦å…·ä½“çœ‹ä»£ç æ‰èƒ½åŒºåˆ†å‡ºæ¥ï¼Œè€Œä¸”æœ‰æ—¶è¿˜è¦å…³æ³¨ä¸‹ä»£ç ç»†èŠ‚ã€‚:cry:
- å¯¹äºä¸ç†Ÿæ‚‰æˆ‘çš„é¡¹ç›®çš„åŒäº‹è¦è·‘èµ·æ¥é¡¹ç›®ï¼Œéœ€è¦é…ç½®å¾ˆå¤šé…ç½®ï¼Œæœ‰æ—¶ä»–ä»¬åªæ˜¯æƒ³çœ‹ä¸‹æ•ˆæœï¼Œæˆ‘éœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´è¿›è¡Œæ²Ÿé€šã€‚

:::

---

## ä¸€ã€dockeræ˜¯ä»€ä¹ˆ

dockeræ˜¯ä¸€ç§**è™šæ‹ŸåŒ–ç¯å¢ƒæŠ€æœ¯**ï¼Œä¾‹å¦‚`vmware`ï¼Œ`virtualbox`ç­‰ï¼Œæœ¬è´¨ä¸Šæ˜¯ç¯å¢ƒéš”ç¦»çš„ä½œç”¨ã€‚å°†é¡¹ç›®ä¸é¡¹ç›®ä¹‹é—´åšåˆ°ç›¸å¯¹çš„ç‹¬ç«‹ã€å±‚æ¬¡æ›´åŠ åˆ†æ˜ã€‚

## äºŒã€dockerçš„ä¼˜åŠ¿

- äº¤ä»˜æ–¹ä¾¿å¿«æ·
- å°†é¡¹ç›®å’Œç¯å¢ƒä¸€èµ·æ‰“åŒ…è¿è¡Œï¼Œå…·æœ‰å¾ˆå¥½çš„éš”ç¦»æ€§
- é™ä½ç»´æŠ¤æˆæœ¬

## ä¸‰ã€ä½¿ç”¨åŸåˆ™

- ä¸€ä¸ªå®¹å™¨åŸåˆ™ä¸Šæ¨èåªéƒ¨ç½²ä¸€ä¸ªåº”ç”¨ï¼Œåº”ç”¨ä¹‹é—´éœ€è¦é€šä¿¡çš„è¦é€šè¿‡å®¹å™¨é—´é€šä¿¡çš„æ–¹å¼é€šä¿¡ã€‚
- æ„å»ºè‡ªå®šä¹‰é•œåƒæ—¶ï¼Œå»ºè®®ä½¿ç”¨æœ€ç²¾ç®€çš„åŸºç¡€é•œåƒ(å‡å°‘é•œåƒå¤§å°)ã€‚
- å½“æœ‰å¤šä¸ªå®¹å™¨(æœåŠ¡)å¯ä»¥å½’ç±»æ—¶ï¼Œå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œï¼Œå°†è¿™äº›å®¹å™¨æ”¾å…¥è‡ªå®šä¹‰ç½‘ç»œï¼Œè€Œå…¶ä»–çš„ä¸å…è®¸è®¿é—®è‡ªå®šä¹‰ç½‘ç»œã€‚
- å½“å¤šä¸ªå®¹å™¨éœ€è¦å…±äº«æ•°æ®æ—¶ï¼Œå»ºè®®ä½¿ç”¨å…¬å…±å·è€Œä¸æ˜¯å…¬å…±å®¹å™¨ã€‚

## å››ã€å®‰è£…

- [ubuntu](https://docs.docker.com/engine/install/ubuntu/)
- [centos](https://docs.docker.com/engine/install/centos/)
- [windows desktop](https://docs.docker.com/desktop/windows/install/)
- [mac desktop](https://docs.docker.com/desktop/mac/install/)
- [docker compose](https://docs.docker.com/compose/install/)

---

::: tip æ›´æ¢é•œåƒæºæº
- è·å–åŠ é€Ÿåœ°å€ï¼šå‰å¾€ => https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors => é•œåƒåŠ é€Ÿå™¨
- ç¼–è¾‘é…ç½®ï¼šç¼–è¾‘(ä¸å­˜åœ¨åˆ™æ–°å»º) /etc/docker/daemon.json ï¼Œæ·»åŠ ï¼š`{"registry-mirrors": ["https://xxxxxxx.mirror.aliyuncs.com"]}`
- é‡å¯ï¼š`systemctl daemon-reload` + `systemctl restart docker`
:::

---

## äº”ã€æ ¸å¿ƒè¦ç´ 

### 5-1ã€é•œåƒ

- åŸºäºå®¿ä¸»æœºå†…æ ¸çš„ã€å¯å åŠ çš„ã€ç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„æ–‡ä»¶ç³»ç»Ÿã€‚
- **é™æ€åªè¯»åˆ†å±‚ç»“æ„**ï¼›é™æ€ï¼šå°±åƒä»£ç ä¸è¿è¡Œèµ·æ¥æ°¸è¿œåªæ˜¯æ²¡æœ‰æ‰§è¡Œçš„å­—æ¯æ–‡å­—ä¸€æ ·ï¼›åªè¯»ï¼šå½“ä¸€ä¸ªé•œåƒæ„å»ºæ—¶ï¼Œç›¸å½“äºåœ¨æ„å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨æœªè¢«è¿è¡Œæ—¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯ä¸ä¼šè¢«å†™å…¥çš„ï¼›åˆ†å±‚ç»“æ„ï¼šä»»ä½•ä¸€ä¸ªé•œåƒéƒ½æ˜¯åŸºäºä¸€ä¸ªåŸºç¡€é•œåƒï¼Œå³åœ¨åŸºç¡€é•œåƒä¹‹ä¸Šè¢«é‡æ–°æ„å»ºã€‚
- æˆ‘ä»¬çš„é¡¹ç›®æˆ–è€…ç¯å¢ƒéƒ½æ˜¯åŸºäºä¸€ä¸ªåŸºç¡€é•œåƒï¼Œç„¶åæ¥ç¼–å†™ç¯å¢ƒã€é¡¹ç›®ä»£ç ç­‰å†…å®¹ã€‚

---

::: tip
- å¯¹äºè‡ªå®šä¹‰é•œåƒï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ `Dockerfile` æ¥åœ¨åŸºç¡€é•œåƒçš„åŸºç¡€ä¸Šï¼Œä¸°å¯Œæˆ‘ä»¬è‡ªå·±çš„éœ€è¦çš„åŠŸèƒ½ã€‚eg: [è‡ªå®šä¹‰æ„å»ºLNMPç¯å¢ƒ](https://github.com/JerryTZF/fpm-nginx-image/blob/main/lnmp-image/php8.0-fpm/Dockerfile)
- ä¸€äº›å®˜æ–¹é•œåƒï¼Œé•œåƒå†…éƒ¨å¼€æ”¾äº†å¾ˆå¤šå¯¹åº”çš„å¯åŠ¨å·¥å…·æˆ–è€…å…¶ä»–å·¥å…·ï¼Œåœ¨ä½¿ç”¨å®˜æ–¹é•œåƒæ—¶ï¼Œè¯·å°½é‡å» `dockerhub` é˜…è¯»æ–‡æ¡£ã€‚
:::

---

### 5-2ã€å®¹å™¨

- å®¹å™¨æ˜¯è¿è¡Œæ—¶(Runtime)çš„ï¼Œå®ƒåŒ…å«äº†é¡¹ç›®çš„æ‰€æœ‰è¿è¡Œç¯å¢ƒ(ç³»ç»Ÿã€ä»£ç ã€ä¾èµ–åŒ…ã€è¯­è¨€ç¯å¢ƒç­‰)ã€‚
- å®¹å™¨ä¸å®¹å™¨ä¹‹é—´ç›¸äº’éš”ç¦»çš„(æ²™ç®±æœºåˆ¶)ï¼Œç›¸äº’ä¸ä¼šå½±å“ã€‚
- æ‰€æœ‰å¯¹å®¹å™¨çš„æ”¹åŠ¨ - æ— è®ºæ·»åŠ ã€åˆ é™¤ã€è¿˜æ˜¯ä¿®æ”¹æ–‡ä»¶éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­ã€‚åªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå®¹å™¨å±‚ä¸‹é¢çš„æ‰€æœ‰é•œåƒã€‚å±‚éƒ½æ˜¯åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®¹å™¨ä¿®æ”¹å†…å®¹æ˜¯ä¸ä¼šå½±å“ä¾èµ–äºè¯¥é•œåƒçš„å…¶ä»–å®¹å™¨ã€‚

---

![å®¹å™¨é•œåƒç»“æ„](https://img.tzf-foryou.xyz/img/20231228224707.png)

::: warning ã€è¯´æ˜ã€‘
ç®€å•ç†è§£ï¼Œé•œåƒå’Œå®¹å™¨å¯ä»¥ç†è§£ä¸ºç±»(Class)å’Œå¯¹è±¡(Object)çš„å…³ç³»ï¼Œå®ä¾‹åŒ–ç±»ä¹‹å‰ï¼Œç±»åªæ˜¯å£°æ˜äº†ç¯å¢ƒã€ä¾èµ–ç­‰å…³ç³»ï¼Œåªæœ‰å½“å®ä¾‹åŒ–å¯¹è±¡åï¼Œæ‰å¯ä»¥å¯¹å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯ç±»æœ¬èº«æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼Œå†æ¬¡å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡æ˜¯ä¸ä¼šçœ‹åˆ°ä¹‹å‰å¯¹è±¡ä¿®æ”¹çš„å˜åŒ–ã€‚
:::

### 5-3ã€ç½‘ç»œ

> dockerçš„ç½‘ç»œåŸºæœ¬åˆ†ä¸ºå››ç§æ¨¡å¼ï¼š

- **Host**ï¼šä¸»æœºæ¨¡å¼ï¼›å¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨hostæ¨¡å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„ `Network Namespace`ï¼Œ
  è€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª `Network Namespace` ã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ã€‚

- **Container**ï¼šå®¹å™¨æ¨¡å¼ï¼›è¿™ä¸ªæ¨¡å¼æŒ‡å®šæ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ª `Network Namespace`ï¼Œ
  è€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´ç­‰ã€‚

- **None**: æ²¡æœ‰ç½‘ç»œæ¨¡å¼ï¼›è¿™ç§æ¨¡å¼ä¸‹ï¼ŒDockerå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„ `Network Namespace`ï¼Œä½†æ˜¯ï¼Œå¹¶ä¸ä¸º `Docker` å®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ã€‚
  ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª `Docker` å®¹å™¨æ²¡æœ‰ç½‘å¡ã€IPã€è·¯ç”±ç­‰ä¿¡æ¯ã€‚éœ€è¦æˆ‘ä»¬è‡ªå·±ä¸º `Docker` å®¹å™¨æ·»åŠ ç½‘å¡ã€é…ç½®IPç­‰ã€‚

- **Bridge**: ç½‘æ¡¥æ¨¡å¼ï¼›bridgeæ¨¡å¼æ˜¯ `Docker` é»˜è®¤çš„ç½‘ç»œè®¾ç½®ï¼Œæ­¤æ¨¡å¼ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é… `Network Namespace`ã€è®¾ç½®IPç­‰ï¼Œ
  å¹¶å°†ä¸€ä¸ªä¸»æœºä¸Šçš„ `Docker` å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚

- **overlay2**ï¼š`overlay` ç½‘ç»œç”¨äºè¿æ¥ä¸åŒæœºå™¨ä¸Šçš„ `Docker` å®¹å™¨ï¼Œå…è®¸ä¸åŒæœºå™¨ä¸Šçš„å®¹å™¨ç›¸äº’é€šä¿¡ï¼ŒåŒæ—¶æ”¯æŒå¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚

---

![æ¡¥æ¥æ¨¡å¼](https://img.tzf-foryou.xyz/img/20220331194017.png)

---

::: warning ã€æ³¨æ„ã€‘
- å¤šä¸ªå®¹å™¨é—´é€šä¿¡è¯·åŠ¡å¿…ä¿è¯åœ¨åŒä¸€ç½‘ç»œä¸‹ã€‚
- ä¸åŒåŠŸèƒ½çš„æœåŠ¡(servers)é›†ï¼Œå°½é‡ä¿è¯åœ¨ä¸åŒçš„ç½‘ç»œä¸‹ï¼Œä¸¾ä¾‹ï¼šå‰ç«¯çš„server1ã€server2â€¦ç­‰åœ¨ä¸€ä¸ªç½‘ç»œä¸‹ï¼Œåç«¯server1ã€server2â€¦ç­‰åœ¨å¦ä¸€ä¸ªç½‘ç»œä¸‹ã€‚
- åŒä¸€ç½‘ç»œä¸‹çš„ä¸åŒæœåŠ¡æ²¡æœ‰å¿…è¦ç¼–æ’åœ¨ä¸€ä¸ª `docker-compose.yml` å†…ã€‚
:::

### 5-4ã€æ•°æ®å·

**ä½œç”¨**ï¼š

- æ•°æ®æŒä¹…åŒ–ï¼šå½“å®¹å™¨åˆ é™¤æ—¶ï¼Œå®¹å™¨äº§ç”Ÿçš„æ•°æ®ä¾æ—§å¯ä»¥åœ¨ç£ç›˜ä¿å­˜ã€‚
- æ•°æ®å…±äº«ï¼šå®¹å™¨é—´æ•°æ®å¯ä»¥å…±äº«ã€‚
- åŠ¨æ€ä¿®æ”¹ï¼šä¸€äº›é…ç½®æ–‡ä»¶ä¼šæ˜ å°„å‡ºæ¥

---

**æ•°æ®å·çš„ä¸‰ç§æ˜ å°„æ–¹å¼**ï¼š

![dockeræ–‡ä»¶ç³»ç»Ÿ](https://img.tzf-foryou.xyz/img/20220410204852.png)

1. bind mount

> ç»‘å®šå®¹å™¨æŒ‡å®šç›®å½•è‡³å®¿ä¸»æœºæŒ‡å®šç›®å½•ã€‚

```yaml:no-line-numbers
version: "3.5"
services:
  rabbitmq:
    image: rabbitmq:3.8.3-management
    container_name: rabbitmq
    volumes:
      - $PWD/data:/var/lib/rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: root
      RABBITMQ_DEFAULT_PASS: root
      TZ: Asia/Shanghai
    ports:
      - "5672:5672"
      - "15672:15672"
```

---

::: tip
å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹æ•°æ®å·æ˜ å°„çš„ç±»å‹.
```shell:no-line-numbers
# docker inspect dddfd27a73a5
"Mounts": [
         {
             "Type": "bind",
             "Source": "/home/www/docker-servers/rabbitmq/data",
             "Destination": "/var/lib/rabbitmq",
             "Mode": "rw",
             "RW": true,
             "Propagation": "rprivate"
         }
     ],
```
:::

---

2. volume

> ç»‘å®šå®¹å™¨æŒ‡å®šç›®å½•è‡³dockerç®¡ç†çš„å·è·¯å¾„ã€‚

```yaml:no-line-numbers
version: "3.9"
services:
  frontend:
    image: node:lts
    volumes:
      - myapp:/home/node/app
  backend:
  	image: sss
  	volumes:
  	  - myapp:/home/node/app
volumes:
  myapp:
``` 

---

```yaml:no-line-numbers
version: "3.9"
services:
  frontend:
    image: node:lts
    volumes:
      - myapp:/home/node/app
volumes:
  myapp:
    external: true
```
---

::: tip
dockerç®¡ç†çš„å·åœ¨ä¸‹é¢ç›®å½•ä¸­
```shell:no-line-numbers
ls /var/lib/docker/volumes/
```
:::

---

3. tmpfs mount

å­˜å…¥å†…å­˜ï¼ŒåŸºæœ¬ä¸ç”¨ï¼Œä¸åšè¿‡å¤šä»‹ç»ã€‚ :stuck_out_tongue:

::: danger ã€æ³¨æ„ã€‘
é›†ç¾¤æ¨¡å¼(Docker Swarm)ä¸‹çš„ä¼šæœ‰ `è¿œç¨‹å·` ã€`å…±äº«å·` ç­‰æ“ä½œï¼Œè¿™ä¸ªåœ¨ `å·çš„ä½¿ç”¨` ç¯‡è¯¦ç»†ä»‹ç»ã€‚
:::

---

